# 数据库表


## 用户表（user）

存储微信授权用户的基础信息与游戏数据，是核心关联表。

| 字段名 | 数据类型 | 是否主键 | 备注 |
|--------|----------|----------|------|
| id | INT | 是（自增） | 用户唯一标识 |
| openid | VARCHAR(64) | 否（唯一索引） | 微信用户唯一标识，用于授权登录 |
| nickname | VARCHAR(32) | 否 | 微信昵称（脱敏处理，避免特殊字符） |
| avatar | VARCHAR(255) | 否 | 微信头像URL |
| points | INT | 否 | 游戏积分（初始0，扫描社团码获1分/次） |
| role | TINYINT | 否 | 角色：0-普通用户，1-社团成员，2-管理员 |
| club_id | INT | 否（外键）| 关联 “社团表（club）” 的 id；仅 “社团成员” 角色需填，普通用户 / 管理员填 0 或 NULL |
| first_entry_time | DATETIME | 否 | 首次进入游戏时间（默认当前时间） |
| update_time | DATETIME | 否 | 积分/角色更新时间（默认当前时间） |


## 社团表（club）

存储参与游园会的社团信息，用于生成社团专属二维码。

| 字段名 | 数据类型 | 是否主键 | 备注 |
|--------|----------|----------|------|
| id | INT | 是（自增） | 社团唯一标识 |
| club_name | VARCHAR(32) | 否（唯一索引） | 社团名称（如“篮球社”“动漫社”） |


## 社团二维码token表（qrcode_token）

存储社团生成的临时二维码token，控制“用后即弃”和防重复扫描。

| 字段名 | 数据类型 | 是否主键 | 备注 |
|--------|----------|----------|------|
| id | INT | 是（自增） | token唯一标识 |
| token | VARCHAR(64) | 否（唯一索引） | 二维码内容（社团ID+随机数的Hash值） |
| club_id | INT | 否（外键） | 关联“社团表（club）”的id |
| is_used | TINYINT | 否 | 状态：0-未使用，1-已使用（默认0） |
| expire_time | DATETIME | 否 | 过期时间（默认生成后5分钟，防止长期有效） |
| create_time | DATETIME | 否 | token生成时间（默认当前时间） |


## 用户Bingo格子状态表（bingo_grid）

记录每个用户的5*5格子点亮情况，前端仅展示，后端控制状态。

| 字段名 | 数据类型 | 是否主键 | 备注 |
|--------|----------|----------|------|
| id | INT | 是（自增） | 记录唯一标识 |
| user_id | INT | 否（外键） | 关联“用户表（user）”的id |
| grid_row | TINYINT | 否 | 格子行号（1-5，对应5*5的行） |
| grid_col | TINYINT | 否 | 格子列号（1-5，对应5*5的列） |
| is_lit | TINYINT | 否 | 点亮状态：0-未点亮，1-已点亮（默认0） |
| lit_time | DATETIME | 否 | 点亮时间（点亮时更新） |
| UNIQUE KEY | (user_id, grid_row, grid_col) | - | 唯一约束：同一用户的同一格子仅一条记录 |


## 领奖token表（award_token）

存储用户满足Bingo条件后生成的领奖凭证，用于线下兑换验证。

| 字段名 | 数据类型 | 是否主键 | 备注 |
|--------|----------|----------|------|
| id | INT | 是（自增） | 领奖记录唯一标识 |
| token | VARCHAR(64) | 否（唯一索引） | 领奖码（用户ID+Bingo类型+时间的Hash值） |
| user_id | INT | 否（外键） | 关联“用户表（user）”的id |
| bingo_type | VARCHAR(16) | 否 | Bingo类型：横排、竖排、斜排、全图 |
| award_level | TINYINT | 否 | 奖品等级：1-一等奖，2-二等奖，3-三等奖 |
| is_verified | TINYINT | 否 | 验证状态：0-未验证，1-已验证（默认0） |
| create_time | DATETIME | 否 | 领奖码生成时间（默认当前时间） |
| verify_time | DATETIME | 否 | 管理员验证时间（验证时更新） |


## 邀请码表（invite_code）

用于生成社团成员/管理员的后台登录权限，绑定角色。

| 字段名 | 数据类型 | 是否主键 | 备注 |
|--------|----------|----------|------|
| id | INT | 是（自增） | 邀请码唯一标识 |
| code | VARCHAR(16) | 否（唯一索引） | 邀请码（随机字符串，如“CLUB202401”“ADMIN001”） |
| role | TINYINT | 否 | 绑定角色：1-社团成员，2-管理员 |
| club_id | INT | 否（外键） | 仅“社团成员”角色需关联，管理员角色填0 |
| is_used | TINYINT | 否 | 状态：0-未使用，1-已使用（默认0） |
| create_time | DATETIME | 否 | 邀请码生成时间（默认当前时间） |
| use_time | DATETIME | 否 | 被使用时间（使用时更新） |
