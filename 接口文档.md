# 接口文档

## 认证说明

所有需要认证的接口都需要在请求头中携带 JWT Token：

```
Authorization: Bearer <your_jwt_token>
```

## 返回值模板

```json
{
    "code": 200,
    "message": "Success",
    "data": {} // 返回的数据
}
```

## 用户模块

### 登录

POST /users/login

#### 请求

```json
{
    "student_id": 2021000001
}
```

#### 正常响应

```json
{
    "code": 200,
    "message": "登录成功",
    "data": {
        "userToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "userInfo": {
            "studentId": 2021000001,
            "firstEnterTime": "2024-01-01T00:00:00",
            "role": "normal" // 角色（normal=普通用户，club=社团成员，admin=管理员）
        }
    }
}
```

#### 错误响应

```json
{
    "code": 400,
    "message": "用户注册失败: 错误详情",
    "data": null
}
```

### 邀请码验证

POST /users/verify

需要 jwt 鉴权为用户

#### 请求

```json
{
    "inviteCode": "ADMIN001"
}
```

#### 正常响应

```json
{
    "code": 200,
    "message": "邀请码验证成功",
    "data": {
        "role": "admin", // 角色（admin=管理员，club=社团成员）
        "clubName": "admin", // 社团名称（role=club时返回社团名称，否则返回 admin）
        "newToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." // 新的 token
    }
}
```

#### 错误响应

```json
{
    "code": 400,
    "message": "邀请码无效或已被使用",
    "data": null
}
```

## 社团模块

### 社团二维码刷新

GET /clubs/qrcode

需要 jwt 鉴权为社团成员

#### 请求

无需请求参数

#### 正常响应

```json
{
    "code": 200,
    "message": "Success",
    "data": {
        "qrcodeToken": "hash_club_c001_rand8927"
    }
}
```

#### 错误响应

```json
{
    "code": 400,
    "message": "User not associated with any club",
    "data": null
}
```

### 扫码社团二维码

POST /clubs/scan

需要 jwt 鉴权为用户

#### 请求

```json
{
    "qrcodeToken": "hash_club_c001_rand8927"
}
```

#### 正常响应

```json
{
    "code": 200,
    "message": "Success",
    "data": {
        "addedPoint": 1, //新增普通积分
        "addedSpecialPoint": 0 //新增特殊积分
    }
}
```

#### 错误响应

```json
{
    "code": 400,
    "message": "Invalid or expired QR code",
    "data": null
}
```

## bingo 模块

### 获取 bingo 状态

GET /bingo/status

需要 jwt 鉴权为用户

#### 请求

无需请求参数

#### 正常响应

```json
{
    "code": 200,
    "message": "Success",
    "data": {
        "point": 3, // 当前普通积分
        "specialPoint": 1, // 当前特殊积分
        "bingoGrid": [
            [1,0,0,0,1],
            [1,0,0,1,0],
            [1,0,1,0,0],
            [1,1,0,0,0],
            [1,0,0,0,0]
        ], // 5*5 Bingo 格子状态（0=未点亮，1=已点亮）
        "rewards": [2] // 当前已获得奖品
    }
}
```

### 点亮 bingo 格子

POST /bingo/light

需要 jwt 鉴权为用户

#### 请求

```json
{
    "pointType": "normal", // 积分类型（normal = 普通，special = 特殊）
    "location": [0,1] // 目标格子坐标（如 [0,1]，仅 pointType = special 时必传）
}
```

#### 正常响应

```json
{
    "code": 200,
    "message": "Success",
    "data": {
        "point": 2, // 当前普通积分
        "specialPoint": 1, // 当前特殊积分
        "bingoGrid": [
            [1,0,0,0,1],
            [1,0,0,1,0],
            [1,0,1,0,0],
            [1,1,0,0,0],
            [1,0,0,0,0]
        ], // 5*5 Bingo 格子状态（0=未点亮，1=已点亮）
        "rewards": [2] // 当前已获得奖品
    }
}
```

#### 错误响应

```json
{
    "code": 400,
    "message": "Not enough normal points",
    "data": null
}
```

```json
{
    "code": 400,
    "message": "Not enough special points",
    "data": null
}
```

```json
{
    "code": 400,
    "message": "Location is required for special points",
    "data": null
}
```

```json
{
    "code": 400,
    "message": "All cells are already lit",
    "data": null
}
```

## 领奖模块

### 生成领奖二维码

POST /reward/qrcode

需要 jwt 鉴权为用户

#### 请求

```json
{
    "reward": 1 // 领奖等级 范围为1-7（1-6为一般奖励 7为彩蛋奖励）
}
```

#### 正常响应

```json
{
    "code": 200,
    "message": "Success",
    "data": {
        "rewardToken": "hash_u123456_horizontal_1696900000"
    }
}
```

#### 错误响应

```json
{
    "code": 400,
    "message": "User does not have enough bingo",
    "data": null
}
```

### 管理员验证二维码

POST /reward/verify

需要 jwt 鉴权为管理员

#### 请求

```json
{
    "rewardToken": "hash_u123456_horizontal_1696900000" // 扫码得到的领奖 token
}
```

#### 正常响应

```json
{
    "code": 200,
    "message": "Success",
    "data": {
        "studentId": 2021000001,
        "reward": 1 // 奖品号
    }
}
```

#### 错误响应

```json
{
    "code": 400,
    "message": "Invalid reward token",
    "data": null
}
```

```json
{
    "code": 400,
    "message": "This reward token has already been verified",
    "data": null
}
```

```json
{
    "code": 404,
    "message": "User not found",
    "data": null
}
```
