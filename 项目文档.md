# Bingo H5 小游戏项目文档

## 项目概述

社团工作部主办的社团游园会中设计了 bingo 小游戏，需要相应的 H5 小程序以完成其功能，同时还能给社团工作部公众号引流

## 项目原型

### 项目全流程

用户通过社工公众号下方菜单栏进入 bingo 小游戏页面，通过学号与姓名注册登陆后显示一个 5*5 的 bingo 小游戏，页面中可调用摄像头扫描各社团的二维码（各社团成员于页面特定入口处进入后台展示二维码）获得积分，积分可随机点亮一个格子，特定社团的二维码能获得特殊积分，特殊积分可点亮任意一个格子，集齐bingo线（横排、竖排、斜排）后可兑换奖品

### 领奖逻辑

共 6 个普通奖励与 1 个彩蛋奖励

1 条 bingo 线可随机抽取 1 个普通奖励

点亮25个格子可领取彩蛋奖励

### 可选扩展

- 纪念性截图：用户达成特定条件可展示各种信息以供截图分享（用户昵称、用户头像、bingo 完成情况）
- 实时排名：达成 bingo 格子数排名（30s 刷新一次）（可能需要 Redis）
- 彩蛋奖：心型格子特殊奖励
- 多轮 bingo
- 数据统计（参与人数、扫码人数、bingo 达成数、热门社团等）
- 后台异常行为监控
- 攻防
- 限流

## 需求分析

### bingo 小游戏页面（前端）

- bingo 小游戏 UI
- 结束倒计时
- 调用摄像头（https://github.com/mebjas/html5-qrcode）
- 通过二维码获得 bingo（抽格子）积分
- 使用积分\特殊积分（抽卡动画？）
- 显示当前可获取的奖励
- 生成二维码领奖码
- 后台（页面最下方小字进入）
  - 二维码刷新（社团可用）（每个社团每次生成一个用后即弃二维码）
  - 领奖验证（管理员可用）

### 后端

- 用户管理（用户 学号、首次进入时间、积分、用户角色）
- 社团管理（id、社团名称）
- 游戏状态管理（用户 bingo 格子状态、bingo 条件校验）
- 领奖管理（领奖 token）
- 二维码 token 管理（社团昵称至 token 的映射）（防止分析社团二维码）
- 二维码扫描管理（防止用户重复扫同一个社团的码）（用户 id，社团名称）
- 邀请码管理（角色）
- HTTPS
- 后台
  - 二维码生成（内容为特定短链接）
  - 领奖验证
  - 生成邀请码

## 技术设计

### 社团二维码

社团成员刷新二维码时向后端发送获取 token 请求

后端构造 token（社团名称+随机数的 hash）存入数据库并发送

社团成员前端完成社团二维码渲染

用户扫描二维码向后端发送获取积分请求（附带该 token）

后端鉴权后增加该用户积分将并该 token 置为已使用

### 领奖二维码

用户向后端发送获取领奖请求

后端验证后向用户发送领奖 token（用户 id+领奖 bingo 等级+领奖时间的 hash）并将此 token 存入数据库

前端完成领奖二维码渲染

管理员扫描领奖二维码进行确认

后端将该 token 置为已使用

### 管理员/社团成员

通过邀请码获得登入后台的权限

### bingo 小游戏 UI

前端只负责展示当前格子状态

所有操作由后端负责

### bingo 小游戏

分为四种 bingo：横向（5）、竖向（5）、斜向（2）

不同种类 bingo 之间无冲突

### 技术栈

- 前端：仅面向移动端设计
- 后端：FastAPI、MySQL

## 分工

### 前端

- bingo 页面 UI 设计
- bingo 页面开发
- 微信 SDK 对接（微信登陆、微信摄像头调用）
- 二维码生成

### 后端

- API 设计
- 数据库设计
- 用户管理
- bingo 游戏管理
- 限流
- 测试

### 运维

- 部署
